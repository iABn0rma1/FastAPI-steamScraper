<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discounted Games - Steam Style</title>
    <!-- <link href="{{ url_for('static', path='/css/main.css') }}" rel="stylesheet"> -->
    <style>
        body {
            font-family: Arial, sans-serif;
            color: #c7d5e0;
            background-color: #1b2838;
            margin: 0;
        }

        h1 {
            text-align: center;
            margin: 3vw 0;
            color: #9099a1;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 0 10vw;
            margin-bottom: 30px;
        }

        a {
            text-decoration: none;
        }

        .grid-item {
            background-color: #2a475e;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transform: scale(1);
            transition: 1.5s;
        }

        .grid-item:hover {
            transform: scale(1.025);
            box-shadow: 0 0 5px #BEEE11;
            text-shadow: 0 0 1px #4c6b22;
            transition: 1.5s;
        }

        .game-header {
            display: flex;
            margin-bottom: 20px;
        }

        .game-image {
            width: 120px;
            height: 45px;
            margin-right: 10px;
            border-radius: 5px;
        }

        .game-title {
            font-size: 1rem;
            color: #BEEE11;
            margin: 0;
        }

        .game-pricing {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .discount {
            color: #BEEE11;
            background-color: #4c6b22;
            padding: 10px;
            border-radius: 5px;
            font-size: 1rem;
        }

        .prices {
            text-align: right;
        }

        .original-price {
            text-decoration: line-through;
            font-size: 0.9rem;
            color: #c7d5e0;
            margin: 0;
        }

        .discounted-price {
            font-size: 1.2rem;
            color: #BEEE11;
            margin: 0;
            padding-top: 5px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #4c6c8c;
            margin: 10px 0;
        }

        .game-info p {
            margin: 0;
        }

        .game-info p img {
            vertical-align: top;
        }

        .platform-icons img {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }

        .loading-animation {
            display: flex;
            justify-content: center;
            margin: 3vw 0 5vw 0;
        }

        .lds-hourglass,
        .lds-hourglass:after {
            box-sizing: border-box;
        }

        .lds-hourglass {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
        }

        .lds-hourglass:after {
            content: " ";
            display: block;
            border-radius: 50%;
            width: 0;
            height: 0;
            margin: 8px;
            box-sizing: border-box;
            border: 32px solid currentColor;
            border-color: currentColor transparent currentColor transparent;
            animation: lds-hourglass 1.2s infinite;
        }

        @keyframes lds-hourglass {
            0% {
                transform: rotate(0);
                animation-timing-function: cubic-bezier(0.55, 0.055, 0.675, 0.19);
            }

            50% {
                transform: rotate(900deg);
                animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
            }

            100% {
                transform: rotate(1800deg);
            }
        }

        .scroll-to-top {
            position: fixed;
            bottom: 40px;
            right: 30px;
            display: none;
            border: none;
            border-radius: 50%;
            padding: 15px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s;
        }

        .scroll-to-top:hover {
            background-color: #2a475e;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #171d25;
            color: #dcdedf;
            padding: 3vw 10vw;
            position: relative;
        }

        .navbar-brand .logo {
            height: 40px;
        }

        .navbar-links {
            display: flex;
            align-items: center;
            gap: 5vw;
        }

        .nav-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 20px;
        }

        .nav-list li {
            margin: 0;
        }

        .nav-list a {
            text-decoration: none;
            color: #dcdedf;
        }

        .login-btn {
            background-color: #5c7e10;
            color: #e5e4dc;
            padding: 8px 16px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 4px;
        }

        .hamburger .bar {
            width: 25px;
            height: 3px;
            background-color: #dcdedf;
            border-radius: 3px;
        }

        .epiContainer {
            background-color: rgba(0, 0, 0, 0.2);
        }

        .epiContainer h1 {
            padding: 3.5vw 0 2vw;
        }

        .epic-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2vw;
            padding: 0 10vw 5vw;
            justify-items: center;
            align-items: center;
        }

        .epic {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            transform: scale(1);
            transition: 1.5s;
        }

        .epic:hover {
            transform: scale(1.025);
            box-shadow: 0 0 5px #BEEE11;
            text-shadow: 0 0 1px #4c6b22;
            transition: 1.5s;
        }

        .epic-game {
            position: relative;
            width: 100%;
            margin: auto;
            padding-bottom: 30px;
        }

        .epic-game img {
            width: 100%;
            height: auto;
            aspect-ratio: 2 / 3;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            display: block;
        }

        .epicNow,
        .epicSoon {
            position: absolute;
            bottom: 2px;
            left: 0;
            width: 100%;
            padding: 5px 0;
            border-bottom-right-radius: 5px;
            border-bottom-left-radius: 5px;
            font-size: 0.69rem;
            text-align: center;
            color: #FFFFFF;
            background-color: #000000;
        }

        .epicNow {
            background-color: #26BBFF;
            color: #000000;
        }

        .epic-data {
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 30px 20px 20px 20px;
            /* background-color: #2a475e; */
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .epic .epic-data .date-time {
            color: #FFFFFFA6 !important;
        }

        .epic-data p {
            font-size: 1rem;
            color: #FFFFFF;
            height: 40px;
            margin: 0;
        }

        @media (max-width: 1200px) {
            .epic-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }

        @media (max-width: 800px) {
            .navbar {
                padding: 3vw 15vw;
            }

            .navbar-links {
                display: none;
                position: absolute;
                top: 60px;
                right: 0;
                background-color: #171d25;
                width: 100%;
                flex-direction: column;
                align-items: center;
                padding: 10px;
                gap: 10px;
            }

            .navbar-links.active {
                display: flex;
                z-index: 1;
                gap: 50px;
                padding: 30px 0;
                text-align: center;
            }

            .nav-list {
                flex-direction: column;
                gap: 30px;
            }

            .nav-list a {
                padding: 10px;
            }

            .hamburger {
                display: flex;
            }

            .grid-container {
                padding: 0 15vw;
            }

            .scroll-to-top {
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            .navbar {
                padding: 3vw 30px;
            }

            .grid-container {
                padding: 0 30px;
            }
        }
    </style>
</head>

<body>

    <nav class="navbar">
        <div class="navbar-brand">
            <a href="/">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                    id="Layer_1" x="0px" y="0px" width="175px" height="44px" viewBox="0 0 355.666 89.333"
                    enable-background="new 0 0 355.666 89.333" xml:space="preserve">
                    <g>
                        <path fill="#C5C3C0"
                            d="M44.238,0.601C21,0.601,1.963,18.519,0.154,41.29l23.71,9.803c2.009-1.374,4.436-2.179,7.047-2.179   c0.234,0,0.467,0.008,0.698,0.021l10.544-15.283c0-0.073-0.001-0.144-0.001-0.216c0-9.199,7.483-16.683,16.683-16.683   c9.199,0,16.682,7.484,16.682,16.683c0,9.199-7.483,16.684-16.682,16.684c-0.127,0-0.253-0.003-0.379-0.006l-15.038,10.73   c0.008,0.195,0.015,0.394,0.015,0.592c0,6.906-5.617,12.522-12.522,12.522c-6.061,0-11.129-4.326-12.277-10.055L1.678,56.893   c5.25,18.568,22.309,32.181,42.56,32.181c24.432,0,44.237-19.806,44.237-44.235C88.475,20.406,68.669,0.601,44.238,0.601">
                        </path>
                        <path fill="#C5C3C0"
                            d="M27.875,67.723l-5.434-2.245c0.963,2.005,2.629,3.684,4.841,4.606c4.782,1.992,10.295-0.277,12.288-5.063   c0.965-2.314,0.971-4.869,0.014-7.189c-0.955-2.321-2.757-4.131-5.074-5.097c-2.299-0.957-4.762-0.922-6.926-0.105l5.613,2.321   c3.527,1.47,5.195,5.52,3.725,9.047C35.455,67.526,31.402,69.194,27.875,67.723">
                        </path>
                        <path fill="#C5C3C0"
                            d="M69.95,33.436c0-6.129-4.986-11.116-11.116-11.116c-6.129,0-11.116,4.987-11.116,11.116   c0,6.13,4.987,11.115,11.116,11.115C64.964,44.55,69.95,39.565,69.95,33.436 M50.502,33.417c0-4.612,3.739-8.35,8.351-8.35   c4.612,0,8.351,3.738,8.351,8.35s-3.739,8.35-8.351,8.35C54.241,41.767,50.502,38.028,50.502,33.417">
                        </path>
                        <path fill="#C5C3C0"
                            d="M135.718,30.868l-2.964,5.21c-2.283-1.595-5.377-2.555-8.078-2.555c-3.087,0-4.997,1.278-4.997,3.567   c0,2.781,3.393,3.428,8.436,5.238c5.421,1.917,8.537,4.17,8.537,9.135c0,6.793-5.342,10.608-13.02,10.608   c-3.742,0-8.256-0.966-11.726-3.077l2.162-5.776c2.819,1.489,6.191,2.372,9.197,2.372c4.052,0,5.978-1.495,5.978-3.705   c0-2.529-2.937-3.289-7.678-4.859c-5.403-1.804-9.147-4.171-9.147-9.666c0-6.197,4.963-9.756,12.104-9.756   C129.499,27.604,133.499,29.181,135.718,30.868">
                        </path>
                        <polygon fill="#C5C3C0"
                            points="158.888,34.161 158.888,61.5 151.909,61.5 151.909,34.161 141.779,34.161 141.779,28.175    168.988,28.175 168.988,34.161  ">
                        </polygon>
                        <polygon fill="#C5C3C0"
                            points="183.7,34.143 183.7,41.652 197.056,41.652 197.056,47.638 183.7,47.638 183.7,55.459    199.196,55.459 199.196,61.5 176.723,61.5 176.723,28.175 199.196,28.175 199.196,34.143  ">
                        </polygon>
                        <path fill="#C5C3C0"
                            d="M214.773,55.03l-2.206,6.471h-7.316l12.495-33.325h7.025L237.619,61.5h-7.563l-2.254-6.471H214.773z    M221.219,36.125l-4.551,13.343h9.196L221.219,36.125z">
                        </path>
                        <polygon fill="#C5C3C0"
                            points="273.436,41.056 264.316,60.529 260.378,60.529 251.406,41.23 251.406,61.5 244.723,61.5    244.723,28.175 251.391,28.175 262.591,52.231 273.393,28.175 280.119,28.175 280.119,61.5 273.437,61.5  ">
                        </polygon>
                        <path fill="#C5C3C0"
                            d="M293.611,32.379c0,2.864-2.146,4.649-4.609,4.649c-2.472,0-4.623-1.785-4.623-4.649   c0-2.863,2.151-4.636,4.623-4.636C291.466,27.743,293.611,29.516,293.611,32.379 M285.154,32.379c0,2.396,1.726,3.901,3.848,3.901   c2.114,0,3.833-1.505,3.833-3.901c0-2.403-1.719-3.885-3.833-3.885C286.886,28.494,285.154,29.994,285.154,32.379 M289.066,30.01   c1.195,0,1.597,0.632,1.597,1.315c0,0.626-0.371,1.046-0.823,1.26l1.071,2.007h-0.877l-0.903-1.779H288.2v1.779h-0.73V30.01   H289.066z M288.207,32.142h0.814c0.527,0,0.838-0.331,0.838-0.747c0-0.42-0.223-0.69-0.84-0.69h-0.813V32.142z">
                        </path>
                    </g>
                </svg>
            </a>
        </div>
        <div class="navbar-links">
            <ul class="nav-list">
                <a href="/discounts" class="filter-link" data-filter="discounts">Discounts</a>
                <a href="/freegames" class="filter-link" data-filter="free-games">Free</a>
                <a href="/upcoming" class="filter-link" data-filter="upcoming">Upcoming</a>
                <a href="/top-sellers" class="filter-link" data-filter="top-sellers">Top Sellers</a>
            </ul>
            <a href="#" class="login-btn">Login</a>
        </div>
        <div class="hamburger" onclick="toggleMenu()">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
    </nav>

    <h1 id="page-heading">Free 2 Keep</h1>

    <div class="grid-container" id="games-container" data-loaded="50">
        {% for game in games %}
        <div class="grid-item">
            <a href="{{ game.href }}">
                <div class="game-header">
                    <img src="{{ game.image_url }}" alt="{{ game.Name }} image" class="game-image">
                    <h2 class="game-title">{{ game.Name }}</h2>
                </div>

                <div class="game-info">
                    {% if game.Date == None %}
                    <p> </p>
                    {% else %}
                    <p>{{ game.Date }}</p>
                    {% endif %}

                    {% if game.Reviews == None %}
                    <p> </p>

                    {% else %}

                    <p>
                        {% if 'Positive' in game.Reviews %}
                        <img src="https://store.akamai.steamstatic.com/public/images/v6/user_reviews_positive.png"
                            alt="Positive">
                        {% endif %}
                        {% if 'Mixed' in game.Reviews %}
                        <img src="https://store.akamai.steamstatic.com/public/images/v6/user_reviews_mixed.png"
                            alt="Mixed">
                        {% endif %}
                        {% if 'Negative' in game.Reviews %}
                        <img src="https://store.akamai.steamstatic.com/public/images/v6/user_reviews_negative.png"
                            alt="Negative">
                        {% endif %}
                        -
                        {{game.Reviews_Prcnt}}
                    </p>

                    {% endif %}
                </div>

                <div class="game-pricing">
                    <div class="platform-icons">
                        {% if 'win' in game.Platforms %}
                        <img src="https://store.akamai.steamstatic.com/public/images/v6/icon_platform_win.png?v=3"
                            alt="Windows">
                        {% endif %}
                        {% if 'linux' in game.Platforms %}
                        <img src="https://store.akamai.steamstatic.com/public/images/v6/icon_platform_linux.png"
                            alt="Linux">
                        {% endif %}
                        {% if 'mac' in game.Platforms %}
                        <img src="https://store.akamai.steamstatic.com/public/images/v6/icon_platform_mac.png"
                            alt="MacOS">
                        {% endif %}
                    </div>
                    <div class="discount">
                        {{ game.discountPrcnt }}
                    </div>
                    <div class="prices">
                        <p class="original-price">{{ game.Original_Price }}</p>
                        <p class="discounted-price">{{ game.discount_price }}</p>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}

    </div>

    <div class="epiContainer" id="epic-games">
        {% if epicGames != None %}
        <h1>Free Epic Games</h1>
        <div class="epic-grid">
            {% for epicGame in epicGames %}
            <div class="epic">
                <a href="{{epicGame.store_link}}">
                    <div class="epic-game">
                        <img src="{{epicGame.logo_link}}" alt="{{epicGame.game_name}}">
                        {% if 'Free' in epicGame.start_date %}
                        <p class="epicNow">Free Now</p>
                        {% else %}
                        <p class="epicSoon">Coming Soon</p>
                        {% endif %}
                    </div>
                    <div class="epic-data">
                        <p> {{epicGame.game_name}} </p>
                        <p class="date-time"> {{epicGame.start_date}} - {{epicGame.end_date}}</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <div id="loading" class="loading-animation">
        <div class="lds-hourglass"></div>
    </div>

    <img id="scrollToTopBtn" class="scroll-to-top" src="https://img.icons8.com/ios-glyphs/30/circled-up-2.png"
        alt="circled-up-2" />

    <script>
        function toggleMenu() {
            document.querySelector('.navbar-links').classList.toggle('active');
        }
    </script>

    <script>
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                scrollToTopBtn.style.display = 'block';
            } else {
                scrollToTopBtn.style.display = 'none';
            }
        });

        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>

    <script>
        let loading = false;

        async function loadMoreGames() {
            if (loading) return;

            loading = true;
            const container = document.getElementById('games-container');
            let loaded = parseInt(container.getAttribute('data-loaded'));

            const filter = container.getAttribute('data-filter');
            let url = `/?n=50&offset=${loaded}`;

            if (filter) {
                url = `/${filter}?n=50&offset=${loaded}`;
            }
            else {
                var epic = document.getElementsByClassName("epiContainer");
                epic.style.display = "flex";
            }

            const response = await fetch(url);
            const text = await response.text();

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;

            const newItems = tempDiv.querySelectorAll('.grid-item');
            newItems.forEach(item => container.appendChild(item));

            container.setAttribute('data-loaded', loaded + 50);
            loading = false;
        }

        function updateHeading(filter) {
            const heading = document.getElementById('page-heading');
            var epicGames = document.getElementById("epic-games");
            switch (filter) {
                case 'free-games':
                    heading.textContent = 'Free Games';
                    if (epicGames) {
                        epicGames.style.display = "none";
                    }
                    break;
                case 'upcoming':
                    heading.textContent = 'Upcoming Releases';
                    if (epicGames) {
                        epicGames.style.display = "none";
                    }
                    break;
                case 'top-sellers':
                    heading.textContent = 'Top Sellers';
                    if (epicGames) {
                        epicGames.style.display = "none";
                    }
                    break;
                case 'discounts':
                    heading.textContent = 'Discounted Games';
                    if (epicGames) {
                        epicGames.style.display = "none";
                    }
                    break;
                default:
                    heading.textContent = 'Free 2 Keep';
                    break;
            }
        }

        window.addEventListener('scroll', () => {
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 2) {
                loadMoreGames();
            }
        });

        document.querySelectorAll('.filter-link').forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();

                const filter = link.getAttribute('data-filter');
                const container = document.getElementById('games-container');

                container.setAttribute('data-filter', filter);
                container.setAttribute('data-loaded', 0);
                container.innerHTML = '';

                updateHeading(filter);
                loadMoreGames();
            });
        });
    </script>

</body>

</html>